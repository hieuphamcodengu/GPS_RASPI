<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è C·∫•u h√¨nh h·ªá th·ªëng</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 0.9em;
        }

        .config-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .config-section h2 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group .description {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-style: italic;
        }

        .form-group input[type="number"],
        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-with-unit {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-with-unit input {
            flex: 1;
        }

        .unit {
            font-weight: bold;
            color: #667eea;
            min-width: 60px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-reset {
            background: #ff6b6b;
            color: white;
        }

        .btn-back {
            background: #6c757d;
            color: white;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: bold;
            text-align: center;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .current-value {
            display: inline-block;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #666;
            margin-left: 10px;
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è C·∫•u h√¨nh h·ªá th·ªëng</h1>
            <p>ƒêi·ªÅu ch·ªânh c√°c th√¥ng s·ªë ho·∫°t ƒë·ªông c·ªßa xe t·ª± h√†nh</p>
        </div>

        <div id="statusMessage" class="status-message"></div>

        <!-- Navigation Settings -->
        <div class="config-section">
            <h2>üöó C·∫•u h√¨nh ƒëi·ªÅu khi·ªÉn</h2>
            
            <div class="form-group">
                <label for="timePerMeter">Th·ªùi gian di chuy·ªÉn m·ªói m√©t</label>
                <div class="description">Th·ªùi gian trung b√¨nh xe ƒëi h·∫øt 1 m√©t (gi√¢y)</div>
                <div class="input-with-unit">
                    <input type="number" id="timePerMeter" step="0.1" min="0.1">
                    <span class="unit">gi√¢y</span>
                </div>
            </div>
        </div>

        <!-- LIDAR Settings -->
        <div class="config-section">
            <h2>üì° C·∫•u h√¨nh LIDAR</h2>
            
            <div class="form-group">
                <label for="lidarMaxPoints">S·ªë ƒëi·ªÉm LIDAR t·ªëi ƒëa</label>
                <div class="description">S·ªë l∆∞·ª£ng ƒëi·ªÉm t·ªëi ƒëa l∆∞u tr·ªØ trong b·ªô nh·ªõ</div>
                <div class="input-with-unit">
                    <input type="number" id="lidarMaxPoints" step="100" min="100">
                    <span class="unit">ƒëi·ªÉm</span>
                </div>
            </div>

            <div class="form-group">
                <label for="lidarDotLifetime">Th·ªùi gian hi·ªÉn th·ªã ƒëi·ªÉm</label>
                <div class="description">Th·ªùi gian m·ªói ƒëi·ªÉm LIDAR hi·ªÉn th·ªã tr√™n radar (gi√¢y)</div>
                <div class="input-with-unit">
                    <input type="number" id="lidarDotLifetime" step="0.1" min="0.1">
                    <span class="unit">gi√¢y</span>
                </div>
            </div>
        </div>

        <!-- LIDAR Obstacle Detection -->
        <div class="config-section">
            <h2>‚ö†Ô∏è Ph√°t hi·ªán v·∫≠t c·∫£n</h2>
            
            <div class="form-group">
                <label for="obstacleDistance">Kho·∫£ng c√°ch c·∫£nh b√°o</label>
                <div class="description">Kho·∫£ng c√°ch t·ªëi thi·ªÉu ƒë·ªÉ k√≠ch ho·∫°t c·∫£nh b√°o v·∫≠t c·∫£n</div>
                <div class="input-with-unit">
                    <input type="number" id="obstacleDistance" step="10" min="50">
                    <span class="unit">mm</span>
                </div>
            </div>

            <div class="form-group">
                <label for="detectionAngleMin">G√≥c ph√°t hi·ªán t·ªëi thi·ªÉu</label>
                <div class="description">G√≥c b·∫Øt ƒë·∫ßu v√πng ph√°t hi·ªán (√¢m = b√™n tr√°i)</div>
                <div class="input-with-unit">
                    <input type="number" id="detectionAngleMin" step="1" min="-180" max="180">
                    <span class="unit">ƒë·ªô</span>
                </div>
            </div>

            <div class="form-group">
                <label for="detectionAngleMax">G√≥c ph√°t hi·ªán t·ªëi ƒëa</label>
                <div class="description">G√≥c k·∫øt th√∫c v√πng ph√°t hi·ªán (d∆∞∆°ng = b√™n ph·∫£i)</div>
                <div class="input-with-unit">
                    <input type="number" id="detectionAngleMax" step="1" min="-180" max="180">
                    <span class="unit">ƒë·ªô</span>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="button-group">
            <button class="btn btn-save" onclick="saveConfigRuntime()">üíæ L∆∞u v√†o b·ªô nh·ªõ</button>
            <button class="btn btn-save" onclick="saveConfigPermanent()" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">üíø L∆∞u vƒ©nh vi·ªÖn</button>
        </div>
        <div class="button-group" style="margin-top: 10px;">
            <button class="btn btn-reset" onclick="resetToDefault()">üîÑ Reset m·∫∑c ƒë·ªãnh</button>
            <button class="btn btn-back" onclick="goBack()">‚¨ÖÔ∏è Quay l·∫°i</button>
        </div>
    </div>

    <script>
        // Load current config when page loads
        window.addEventListener('DOMContentLoaded', loadConfig);

        function loadConfig() {
            console.log('üîÑ Loading config from server...');
            fetch('/getConfig')
                .then(response => response.json())
                .then(config => {
                    console.log('üì• Received config:', config);
                    document.getElementById('timePerMeter').value = config.TIME_PER_METER_SEC;
                    document.getElementById('lidarMaxPoints').value = config.LIDAR_MAX_POINTS;
                    document.getElementById('lidarDotLifetime').value = config.LIDAR_DOT_LIFETIME;
                    document.getElementById('obstacleDistance').value = config.LIDAR_OBSTACLE_DISTANCE;
                    document.getElementById('detectionAngleMin').value = config.LIDAR_DETECTION_ANGLE_MIN;
                    document.getElementById('detectionAngleMax').value = config.LIDAR_DETECTION_ANGLE_MAX;
                    console.log('‚úÖ Config loaded successfully');
                })
                .catch(error => {
                    console.error('‚ùå Error loading config:', error);
                    showMessage('L·ªói khi t·∫£i c·∫•u h√¨nh: ' + error, 'error');
                });
        }

        function saveConfigRuntime() {
            const config = getConfigValues();
            console.log('üì§ Saving to RUNTIME (temporary):', config);

            fetch('/saveConfigRuntime', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(result => {
                console.log('üì• Server response:', result);
                if (result.success) {
                    showMessage('‚úÖ ƒê√£ l∆∞u v√†o b·ªô nh·ªõ (t·∫°m th·ªùi, m·∫•t khi restart server)', 'success');
                } else {
                    showMessage('‚ùå L·ªói: ' + result.message, 'error');
                }
            })
            .catch(error => {
                console.error('‚ùå Error saving config:', error);
                showMessage('‚ùå L·ªói khi l∆∞u c·∫•u h√¨nh: ' + error, 'error');
            });
        }

        function saveConfigPermanent() {
            const config = getConfigValues();
            console.log('üì§ Saving to settings.json (permanent):', config);

            fetch('/saveConfigPermanent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(result => {
                console.log('üì• Server response:', result);
                if (result.success) {
                    showMessage('‚úÖ ƒê√£ l∆∞u vƒ©nh vi·ªÖn v√†o settings.json!', 'success');
                } else {
                    showMessage('‚ùå L·ªói: ' + result.message, 'error');
                }
            })
            .catch(error => {
                console.error('‚ùå Error saving config:', error);
                showMessage('‚ùå L·ªói khi l∆∞u c·∫•u h√¨nh: ' + error, 'error');
            });
        }

        function getConfigValues() {
            return {
                TIME_PER_METER_SEC: parseFloat(document.getElementById('timePerMeter').value),
                LIDAR_MAX_POINTS: parseInt(document.getElementById('lidarMaxPoints').value),
                LIDAR_DOT_LIFETIME: parseFloat(document.getElementById('lidarDotLifetime').value),
                LIDAR_OBSTACLE_DISTANCE: parseInt(document.getElementById('obstacleDistance').value),
                LIDAR_DETECTION_ANGLE_MIN: parseInt(document.getElementById('detectionAngleMin').value),
                LIDAR_DETECTION_ANGLE_MAX: parseInt(document.getElementById('detectionAngleMax').value)
            };
        }

        function resetToDefault() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh kh√¥ng?')) {
                fetch('/resetConfig', { method: 'POST' })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            showMessage('‚úÖ ƒê√£ reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh!', 'success');
                            loadConfig();
                        } else {
                            showMessage('‚ùå L·ªói: ' + result.message, 'error');
                        }
                    })
                    .catch(error => {
                        showMessage('‚ùå L·ªói khi reset: ' + error, 'error');
                    });
            }
        }

        function showMessage(message, type) {
            const msgDiv = document.getElementById('statusMessage');
            msgDiv.textContent = message;
            msgDiv.className = 'status-message ' + type;
            msgDiv.style.display = 'block';
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 5000);
        }

        function goBack() {
            window.location.href = '/';
        }
    </script>
</body>
</html>
